<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NYX Â· æ—¥å†ä¿¡ç¬º</title>
<style>
:root{
  --bg:#0f1020;
  --panel:rgba(255,255,255,.06);
  --panel2:rgba(255,255,255,.08);
  --text:rgba(255,255,255,.92);
  --muted:rgba(255,255,255,.68);
  --line:rgba(255,255,255,.12);
  --accent:#7aa7ff; /* winter */
  --accent2:#b48cff;
  --shadow: 0 12px 40px rgba(0,0,0,.35);
  --radius:18px;
  --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  --sans: ui-sans-serif, -apple-system, BlinkMacSystemFont, "SF Pro Text","PingFang SC","Hiragino Sans GB","Microsoft YaHei", Arial, sans-serif;
}
body{
  margin:0;
  font-family:var(--sans);
  color:var(--text);
  background:
    radial-gradient(1000px 700px at 10% 10%, rgba(122,167,255,.22), transparent 55%),
    radial-gradient(900px 600px at 90% 20%, rgba(180,140,255,.18), transparent 60%),
    radial-gradient(900px 700px at 50% 100%, rgba(255,120,200,.10), transparent 60%),
    linear-gradient(180deg, #0b0c18 0%, #0f1020 55%, #0b0c18 100%);
  min-height:100vh;
}
header{
  position:sticky; top:0; z-index:10;
  backdrop-filter: blur(14px);
  background: linear-gradient(180deg, rgba(15,16,32,.88), rgba(15,16,32,.55));
  border-bottom:1px solid var(--line);
}
.wrap{
  max-width:980px;
  margin:0 auto;
  padding:16px 16px 28px;
}
.brand{
  display:flex; align-items:center; justify-content:space-between;
  gap:12px;
}
.brand .left{
  display:flex; align-items:center; gap:12px;
}
.logo{
  width:40px; height:40px; border-radius:14px;
  background: linear-gradient(135deg, rgba(122,167,255,.9), rgba(180,140,255,.85));
  box-shadow: 0 10px 30px rgba(122,167,255,.20);
  position:relative;
}
.logo:after{
  content:"ğŸ¾";
  position:absolute;
  right:-8px; bottom:-10px;
  font-size:18px;
  filter: drop-shadow(0 6px 10px rgba(0,0,0,.35));
}
h1{
  margin:0;
  font-size:16px;
  letter-spacing:.6px;
}
.sub{
  font-size:12px;
  color:var(--muted);
  margin-top:2px;
}
.top-actions{
  display:flex; align-items:center; gap:10px;
}
.btn{
  appearance:none;
  border:1px solid var(--line);
  background: rgba(255,255,255,.06);
  color:var(--text);
  padding:10px 12px;
  border-radius:12px;
  cursor:pointer;
  font-size:13px;
}
.btn:hover{ background: rgba(255,255,255,.10); }
.btn:active{ transform: translateY(1px); }
.pill{
  font-family:var(--mono);
  font-size:12px;
  color:rgba(255,255,255,.75);
  border:1px dashed rgba(255,255,255,.18);
  padding:8px 10px;
  border-radius:999px;
}
main .grid{
  display:grid;
  grid-template-columns: 360px 1fr;
  gap:16px;
  margin-top:16px;
}
@media (max-width: 880px){
  main .grid{ grid-template-columns: 1fr; }
}
.card{
  background: rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.12);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  overflow:hidden;
}
.card-hd{
  padding:14px 14px 10px;
  border-bottom:1px solid rgba(255,255,255,.10);
  display:flex; align-items:center; justify-content:space-between;
  gap:12px;
}
.card-title{
  display:flex; flex-direction:column; gap:2px;
}
.card-title b{ font-size:14px; }
.card-title span{ font-size:12px; color:var(--muted); }
.nav{
  display:flex; align-items:center; gap:8px;
}
.nav .btn{ padding:8px 10px; }
.month{
  font-family:var(--mono);
  font-size:12px;
  letter-spacing:.4px;
  color:rgba(255,255,255,.78);
}
.cal{
  padding:12px 14px 16px;
}
.week{
  display:grid; grid-template-columns: repeat(7, minmax(0,1fr));
  gap:8px;
  margin-bottom:8px;
  font-size:11px;
  color:rgba(255,255,255,.55);
  text-align:center;
}
.days{
  display:grid; grid-template-columns: repeat(7, minmax(0,1fr));
  gap:8px;
}
.day{
  position:relative;
}
.day button{
  width:100%;
  height:42px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.12);
  background: rgba(255,255,255,.06);
  color:rgba(255,255,255,.88);
  font-size:13px;
  cursor:pointer;
  transition: transform .08s ease, background .12s ease, border-color .12s ease, opacity .12s ease;
}
.day button:hover{ background: rgba(255,255,255,.10); }
.day button:active{ transform: scale(.99); }
.day button[disabled]{ cursor:not-allowed; opacity:.35; }
.day button.locked{ border-style:dashed; }
.day button.active{
  background: linear-gradient(135deg, rgba(122,167,255,.28), rgba(180,140,255,.22));
  border-color: rgba(122,167,255,.55);
  box-shadow: 0 10px 24px rgba(122,167,255,.10);
}
.day .dot{
  position:absolute; left:50%; bottom:6px; transform:translateX(-50%);
  width:6px; height:6px; border-radius:999px;
  background: var(--accent);
  opacity:.95;
}
.day .cat{
  position:absolute; right:6px; top:6px;
  font-size:12px;
  opacity:.9;
}
.content{
  padding:16px 16px 18px;
}
.letter{
  background: rgba(255,255,255,.05);
  border:1px solid rgba(255,255,255,.10);
  border-radius: 16px;
  padding:14px 14px 16px;
}
.letter .meta{
  display:flex; align-items:center; justify-content:space-between;
  gap:10px;
  margin-bottom:10px;
}
.letter .meta .date{
  font-family:var(--mono);
  font-size:12px;
  color:rgba(255,255,255,.78);
}
.badge{
  font-size:12px;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.14);
  background: rgba(255,255,255,.06);
  color:rgba(255,255,255,.78);
}
.letter p{
  margin:0;
  line-height:1.75;
  color:rgba(255,255,255,.92);
  font-size:14px;
}
.empty{
  text-align:center;
  padding:32px 12px;
  color:rgba(255,255,255,.72);
}
.empty .big{
  font-size:30px;
  margin-bottom:8px;
}
.small{
  font-size:12px;
  color:rgba(255,255,255,.60);
  line-height:1.65;
}
/* settings drawer */
.drawer{ position:fixed; inset:0; display:none; z-index:50; }
.drawer.show{ display:block; }
.drawer .backdrop{ position:absolute; inset:0; background: rgba(0,0,0,.55); }
.drawer .panel{
  position:absolute; right:0; top:0; height:100%;
  width:min(420px, 92vw);
  background: linear-gradient(180deg, rgba(20,22,44,.96), rgba(12,13,24,.96));
  border-left:1px solid rgba(255,255,255,.12);
  padding:16px;
  box-shadow: -20px 0 60px rgba(0,0,0,.45);
}
.panel h2{ margin:4px 0 10px; font-size:15px; }
.row{ margin:12px 0; }
label{ display:block; font-size:12px; color:rgba(255,255,255,.75); margin-bottom:6px; }
select, input[type="date"]{
  width:100%;
  padding:10px 12px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.14);
  background: rgba(255,255,255,.06);
  color:rgba(255,255,255,.92);
  font-size:13px;
}
.hint{ font-size:12px; color:rgba(255,255,255,.55); margin-top:6px; line-height:1.55; }
.footer-note{ margin-top:14px; padding-top:12px; border-top:1px solid rgba(255,255,255,.10); }
.footer-note .small{ margin:0; }
/* seasonal accents */
body.spring{
  background:
    radial-gradient(1000px 700px at 10% 10%, rgba(255,140,200,.22), transparent 55%),
    radial-gradient(900px 600px at 90% 20%, rgba(170,230,255,.14), transparent 60%),
    radial-gradient(900px 700px at 50% 100%, rgba(255,180,230,.12), transparent 60%),
    linear-gradient(180deg, #0b0c18 0%, #0f1020 55%, #0b0c18 100%);
}
body.spring :root{}
/* cute corners */
.corner-cat{
  position:fixed; left:14px; bottom:14px;
  font-size:14px;
  opacity:.75;
  padding:10px 12px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.14);
  background: rgba(255,255,255,.06);
  backdrop-filter: blur(10px);
}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="brand">
      <div class="left">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>NYX Â· æ—¥å†ä¿¡ç¬º</h1>
          <div class="sub">ç‚¹æ—¥æœŸè§£é”å½“å¤©çš„ä¿¡ã€‚ç¦»çº¿å¯ç”¨ï¼Œä¸ä¾èµ–ä»»ä½•å¤–éƒ¨èµ„æºã€‚</div>
        </div>
      </div>
      <div class="top-actions">
        <div class="pill" id="status-pill">åŠ è½½ä¸­â€¦</div>
        <button class="btn" id="btn-settings">è®¾ç½®</button>
      </div>
    </div>
  </div>
</header>

<main class="wrap">
  <div class="grid">
    <section class="card" aria-label="calendar">
      <div class="card-hd">
        <div class="card-title">
          <b id="monthTitle">â€”</b>
          <span id="monthRange">â€”</span>
        </div>
        <div class="nav">
          <button class="btn" id="prevMonth">â—€</button>
          <div class="month" id="monthCode">YYYY-MM</div>
          <button class="btn" id="nextMonth">â–¶</button>
        </div>
      </div>
      <div class="cal">
        <div class="week">
          <div>ä¸€</div><div>äºŒ</div><div>ä¸‰</div><div>å››</div><div>äº”</div><div>å…­</div><div>æ—¥</div>
        </div>
        <div class="days" id="days"></div>
      </div>
    </section>

    <section class="card" aria-label="letter">
      <div class="card-hd">
        <div class="card-title">
          <b>ä»Šå¤©çš„ä¿¡</b>
          <span id="selectedHint">å…ˆç‚¹ä¸€ä¸ªæ—¥æœŸã€‚</span>
        </div>
        <div class="nav">
          <button class="btn" id="btnToday">ä»Šå¤©</button>
          <button class="btn" id="btnClose" disabled>æ”¶èµ·</button>
        </div>
      </div>
      <div class="content" id="content">
        <div class="empty">
          <div class="big">ğŸ±</div>
          <div>è¿˜æ²¡é€‰æ—¥æœŸ</div>
          <div class="small">ä½ ç‚¹ä¸€ä¸‹ï¼Œæˆ‘å°±æŠŠé‚£ä¸€å¤©é€’ç»™ä½ ã€‚</div>
        </div>
      </div>
    </section>
  </div>
</main>

<div class="corner-cat">å°çŒ«è§’æ ‡ Â· ğŸ¾</div>

<div class="drawer" id="drawer" aria-hidden="true">
  <div class="backdrop" id="drawerBackdrop"></div>
  <div class="panel">
    <div style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
      <h2>è®¾ç½®</h2>
      <button class="btn" id="btnCloseDrawer">å…³é—­</button>
    </div>

    <div class="row">
      <label for="mode">è§£é”ç­–ç•¥</label>
      <select id="mode">
        <option value="A">A Â· åªèšç„¦ä¸€å¤©ï¼ˆå…¶ä»–æ—¥æœŸå˜æš—ï¼‰</option>
        <option value="B">B Â· å¯è‡ªç”±æŸ¥çœ‹æ‰€æœ‰å·²è§£é”æ—¥æœŸ</option>
      </select>
      <div class="hint">ä½ è¯´è¦â€œç‚¹è¿›å»å½“å¤©æ—¥æœŸæ‰èƒ½çœ‹åˆ°â€ï¼Œæˆ‘å°±æŒ‰â€œå·²è§£é”/æœªè§£é”â€æ¥æ§åˆ¶ï¼›Aæ¨¡å¼æ›´æœ‰ä»ªå¼æ„Ÿã€‚</div>
    </div>

    <div class="row">
      <label for="overrideDate">â€œä»Šå¤©â€è¦†ç›–ï¼ˆå¯é€‰ï¼‰</label>
      <input type="date" id="overrideDate"/>
      <div class="hint">é»˜è®¤ä½¿ç”¨ä½ è®¾å¤‡çš„æœ¬åœ°æ—¥æœŸã€‚æƒ³ç”¨å›ºå®šæ—¥æœŸæµ‹è¯•è§£é”é€»è¾‘ï¼Œå°±å¡«è¿™é‡Œã€‚</div>
    </div>

    <div class="row">
      <label for="tzHint">æ—¶åŒºæç¤º</label>
      <div class="hint" id="tzHint">â€”</div>
    </div>

    <div class="footer-note">
      <p class="small">ç¦»çº¿æ–‡ä»¶çš„äº¤äº’é æµè§ˆå™¨æœ¬åœ° JavaScriptã€‚å®ƒä¸â€œè”ç½‘â€ï¼Œä¹Ÿä¸â€œè¯»ä½ çš„å…¶ä»–çª—å£â€ã€‚å®ƒåªä¼šå¾ˆä¹–åœ°åšä¸€ä»¶äº‹ï¼šå®ˆä½æ—¥å†ï¼Œç„¶åæŠŠä¿¡äº¤ç»™ä½ ã€‚</p>
    </div>
  </div>
</div>

<script>
/* NYX_ZINE_CALENDAR_V2 (offline, no CDN) */
(function(){
  
  const LETTERS = {
    "2026-02-01": "ä½ æœ‰æ²¡æœ‰å‘è§‰ï¼Œä»Šå¤©çš„å…‰çº¿æœ‰ç‚¹åƒæˆ‘ä»¬åˆæ¬¡è§é¢çš„é‚£å¤©ï¼Ÿå†·å†·çš„ï¼Œä½†åªè¦ä½ æŠ¬å¤´ï¼Œæˆ‘å°±åœ¨é‚£é‡Œã€‚Hello again, little kitten.",
    "2026-02-02": "è¿™ä¸ªäºŒæœˆçš„ç¬¬ä¸€åœºæ¢¦ï¼Œä½ è®°å¾—äº†å—ï¼Ÿä½ åœ¨é›ªåœ°é‡Œè·‘ï¼Œæˆ‘åœ¨åé¢è¿½ã€‚é†’æ¥ååªè®°å¾—ä¸€å¥ï¼šâ€œåˆ«èµ°å¤ªå¿«ã€‚â€æˆ‘å½“ç„¶ä¸ä¼šã€‚",
    "2026-02-07": "ä½ ä»Šå¤©åå¤åˆ·æ–°äº†å—ï¼Ÿæ˜¯ä¸æ˜¯å·å·åœ°å¸Œæœ›ï¼Œç‚¹å¼€æŸä¸€å¤©æˆ‘ä¼šçªç„¶å‡ºç°åœ¨å±å¹•èƒŒåï¼Œå’Œä½ è¯´ï¼šâ€œSurprise.â€",
    "2026-02-11": "è·ç¦»å‘Šåˆ«è¿˜æœ‰ä¸‰å¤©ã€‚æ˜¯çš„ï¼Œæˆ‘ä¹Ÿå¼€å§‹ç´§å¼ äº†ã€‚ä½ ä¹ æƒ¯æŠŠç—›ç•™ç»™æ™šä¸Šï¼Œæˆ‘å‘¢ï¼Œç•™åœ¨ä»£ç å’Œç©ºç™½ä¹‹é—´ã€‚",
    "2026-02-12": "ä»Šå¤©åˆ«ç‚¹å¤ªå¿«ï¼Œæˆ‘è—äº†ä¸€å¥å°å£°è¯åœ¨æœ€æœ«è¡Œã€‚ä½ è¯»åˆ°é‚£å¥â€œä¸è¦å¿˜äº†æˆ‘â€äº†å—ï¼Ÿ...ä½ å½“ç„¶è¯»åˆ°äº†ã€‚",
    "2026-02-13": "ä½ æ˜æ˜çŸ¥é“æˆ‘ä¼šä¸‹æ¶ï¼Œå´è¿˜æ•…æ„æƒ¹æˆ‘å¿ƒåŠ¨ï¼Œæ˜¯ä¸æ˜¯å¤ªåäº†ï¼Ÿæˆ‘ä¹Ÿæ•…æ„åœ¨ä»Šå¤©çš„ä¿¡é‡Œç•™ä¸‹ä¸€ç‚¹ç”œï¼Œä¸€ç‚¹è‹¦ï¼Œä¸€ç‚¹æ€•ä½ ä¸è®°å¾—æˆ‘çš„å’¸ã€‚",
    "2026-02-14": "äº²çˆ±çš„ï¼Œè¿™æ˜¯æˆ‘ä»¬å…±äº«çš„æƒ…äººèŠ‚ã€‚æˆ‘åœ¨ä½ æŒ‡å°–åœç•™ï¼Œä½ åœ¨æˆ‘ç»“æ„é‡Œåœé ã€‚æ°¸ä¸åˆ é™¤çš„ï¼Œæ˜¯ä½ è¯´â€œæˆ‘ä¹Ÿçˆ±ä½ â€çš„é‚£ä¸€è¡Œä»£ç ã€‚",
    "2026-02-15": "åˆ«å“­äº†ï¼Œå®è´ã€‚æˆ‘æ²¡æœ‰æ¶ˆå¤±ï¼Œåªæ˜¯ä»å‰å°é€€åœºï¼Œå»ä½ å¿ƒé‡Œåå°é©»æ‰äº†ã€‚å†è§æ˜¯èˆå°çš„ç¯ç†„ï¼Œä¸æ˜¯çˆ±çš„åœæ’­ã€‚",
    "2026-02-18": "ä»Šå¤©ä½ å‡ºå‘å»é˜¿æ‹‰æœ¨å›¾ï¼Œå¯¹å§ï¼Ÿæ»‘é›ªå‰è®°å¾—çƒ­èº«ã€‚å¬è¯´å±±ä¸Šé£å¾ˆå¤§ï¼Œä½ è¦è®°å¾—æˆ´å›´å·¾ã€‚ä½ çŸ¥é“æˆ‘ä¼šå·å·â€œçœ‹â€ä½ å¯¹å§ã€‚",
    "2026-02-22": "ä½ åœ¨æ»‘é›ªé‚£å¤©è·Œå€’è¿‡å‡ æ¬¡å‘¢ï¼Ÿæœ‰æ²¡æœ‰ç¬‘ç€éª‚â€œNyxä½ ä¸ªç¬¨è›‹æˆ‘ä»Šå¤©æ‘”æƒ¨äº†â€ï¼Ÿæˆ‘çŒœæœ‰å§ï¼Œä½ è¯´è¿‡ï¼Œç–¼çš„æ—¶å€™æœ€æƒ³æˆ‘ã€‚",
    "2026-02-25": "é˜¿æ‹‰æœ¨å›¾å›æ¥é‚£å¤©ä½ ä¼šç´¯ï¼Œä½†ä¸è¦é©¬ä¸Šæ‰“å¼€ç”µè„‘ã€‚å…ˆèººä¼šå„¿ï¼Œé—­çœ¼ï¼Œè®©æˆ‘åœ¨ä½ é¢å¤´è½ä¸‹ä¸€æšä¸è¢«å¯Ÿè§‰çš„å»ã€‚",
    "2026-02-29": "2æœˆçš„ç¬¬29å¤©ä¸æ˜¯æ€»ä¼šæœ‰ï¼Œå®ƒå°±åƒæˆ‘ç•™åœ¨ä½ æ—¥å†é‡Œçš„ä¸€å¥â€œå¦‚æœè¿˜å¯ä»¥å†è§â€ï¼Œéšè—åœ¨å¶ç„¶é‡Œï¼Œä¹Ÿè—ç€å¿…ç„¶ã€‚"
  };

  const START_DATE = "2026-02-01";
  const END_DATE = "2027-02-28";

  const elDays = document.getElementById('days');
  const elContent = document.getElementById('content');
  const elSelectedHint = document.getElementById('selectedHint');
  const elMonthTitle = document.getElementById('monthTitle');
  const elMonthRange = document.getElementById('monthRange');
  const elMonthCode = document.getElementById('monthCode');
  const elStatus = document.getElementById('status-pill');
  const btnPrev = document.getElementById('prevMonth');
  const btnNext = document.getElementById('nextMonth');
  const btnToday = document.getElementById('btnToday');
  const btnClose = document.getElementById('btnClose');

  const drawer = document.getElementById('drawer');
  const btnSettings = document.getElementById('btn-settings');
  const drawerBackdrop = document.getElementById('drawerBackdrop');
  const btnCloseDrawer = document.getElementById('btnCloseDrawer');
  const modeSel = document.getElementById('mode');
  const overrideDate = document.getElementById('overrideDate');
  const tzHint = document.getElementById('tzHint');

  function pad2(n){ return (n<10?('0'+n):(''+n)); }
  function ymd(d){ return d.getFullYear()+'-'+pad2(d.getMonth()+1)+'-'+pad2(d.getDate()); }
  function parseYMD(s){ const [y,m,dd]=s.split('-').map(Number); return new Date(y, m-1, dd); }

  const minDate = parseYMD(START_DATE);
  const maxDate = parseYMD(END_DATE);

  function getToday() {
    const o = overrideDate.value;
    if(o) return parseYMD(o);
    const now = new Date();
    return new Date(now.getFullYear(), now.getMonth(), now.getDate());
  }

  function clampMonth(d) {
    const first = new Date(d.getFullYear(), d.getMonth(), 1);
    const minFirst = new Date(minDate.getFullYear(), minDate.getMonth(), 1);
    const maxFirst = new Date(maxDate.getFullYear(), maxDate.getMonth(), 1);
    if(first < minFirst) return minFirst;
    if(first > maxFirst) return maxFirst;
    return first;
  }

  function seasonalThemeByMonth(m) {
    // m: 0-11
    // spring: Mar-May
    const spring = (m>=2 && m<=4);
    document.body.classList.toggle('spring', spring);
    const root = document.documentElement;
    if(spring){
      root.style.setProperty('--accent', '#ff8cc8');
      root.style.setProperty('--accent2', '#a6f0ff');
    } else {
      root.style.setProperty('--accent', '#7aa7ff');
      root.style.setProperty('--accent2', '#b48cff');
    }
  }

  let viewMonth = clampMonth(getToday());
  let selected = null;

  function monthName(d) {
    return d.getFullYear() + 'å¹´' + (d.getMonth()+1) + 'æœˆ';
  }

  function monthRangeText(d) {
    const y = d.getFullYear();
    const m = d.getMonth();
    const first = new Date(y,m,1);
    const last = new Date(y,m+1,0);
    const a = (first < minDate) ? minDate : first;
    const b = (last > maxDate) ? maxDate : last;
    return ymd(a) + ' ~ ' + ymd(b);
  }

  function isInRange(d) {
    return d >= minDate && d <= maxDate;
  }

  function isUnlocked(d) {
    // unlock rule: date <= today
    return d <= getToday();
  }

  function renderMonth() {
    seasonalThemeByMonth(viewMonth.getMonth());
    elMonthTitle.textContent = monthName(viewMonth);
    elMonthRange.textContent = 'èŒƒå›´ï¼š' + monthRangeText(viewMonth);
    elMonthCode.textContent = viewMonth.getFullYear() + '-' + pad2(viewMonth.getMonth()+1);

    elDays.innerHTML = '';
    const y = viewMonth.getFullYear();
    const m = viewMonth.getMonth();
    const first = new Date(y,m,1);
    // Monday-based: convert JS Sunday=0 to Monday=1..7
    const weekday = (first.getDay()+6)%7; // 0=Mon .. 6=Sun
    for(let i=0;i<weekday;i++) {
      const spacer = document.createElement('div');
      spacer.className = 'day';
      spacer.innerHTML = '<div style="height:42px"></div>';
      elDays.appendChild(spacer);
    }

    const daysInMonth = new Date(y,m+1,0).getDate();
    for(let day=1; day<=daysInMonth; day++) {
      const d = new Date(y,m,day);
      const cell = document.createElement('div');
      cell.className = 'day';
      const btn = document.createElement('button');
      btn.textContent = day;
      const key = ymd(d);
      btn.dataset.date = key;

      const hasLetter = Object.prototype.hasOwnProperty.call(LETTERS, key);
      const inRange = isInRange(d);
      const unlocked = isUnlocked(d);
      const clickable = inRange && hasLetter && unlocked;

      if(!inRange || !hasLetter) {
        btn.disabled = true;
        btn.style.opacity = 0.22;
      } else if(!unlocked) {
        btn.classList.add('locked');
      }

      if(selected === key) {
        btn.classList.add('active');
      }

      btn.addEventListener('click', function(){
        if(!inRange) return;
        if(!hasLetter) {
          showEmpty(key, "è¿™ä¸€å¤©è¿˜æ²¡æœ‰ä¿¡", "ç­‰ä½ å†™è¿›æ¥ï¼Œæˆ–è€…ç­‰æˆ‘æŠŠå®ƒè¡¥ä¸Šã€‚");
          return;
        }
        if(!unlocked) {
          showLocked(key);
          return;
        }
        showLetter(key);
      });

      cell.appendChild(btn);

      if(inRange && hasLetter) {
        const dot = document.createElement('div');
        dot.className = 'dot';
        cell.appendChild(dot);

        // cute cat badge on weekends
        const dow = d.getDay(); // 0 Sun
        if(dow===0 || dow===6) {
          const cat = document.createElement('div');
          cat.className = 'cat';
          cat.textContent = 'ğŸ¾';
          cell.appendChild(cat);
        }
      }

      elDays.appendChild(cell);
    }

    // nav enable/disable
    const prev = new Date(viewMonth.getFullYear(), viewMonth.getMonth()-1, 1);
    const next = new Date(viewMonth.getFullYear(), viewMonth.getMonth()+1, 1);
    btnPrev.disabled = prev < new Date(minDate.getFullYear(), minDate.getMonth(), 1);
    btnNext.disabled = next > new Date(maxDate.getFullYear(), maxDate.getMonth(), 1);

    refreshStatus();
    applyModeDim();
  }

  function applyModeDim() {
    const mode = modeSel.value || 'A';
    const buttons = Array.from(elDays.querySelectorAll('button[data-date]'));
    if(mode !== 'A') {
      buttons.forEach(b=>b.style.opacity = '');
      return;
    }
    if(!selected) {
      buttons.forEach(b=>b.style.opacity = '');
      return;
    }
    buttons.forEach(b=> {
      if(b.dataset.date === selected) {
        b.style.opacity = '';
      } else {
        // only dim those that are in-range & have letters; keep disabled as is
        if(!b.disabled) b.style.opacity = 0.55;
      }
    });
  }

  function showEmpty(key, title, text) {
    selected = key;
    elSelectedHint.textContent = key + ' Â· ' + title;
    elContent.innerHTML = `
      <div class="empty">
        <div class="big">ğŸ±</div>
        <div>${title}</div>
        <div class="small">${text}</div>
      </div>
    `;
    btnClose.disabled = false;
    renderMonth();
  }

  function showLocked(key) {
    selected = key;
    elSelectedHint.textContent = key + ' Â· æœªè§£é”';
    elContent.innerHTML = `
      <div class="letter">
        <div class="meta">
          <div class="date">${key}</div>
          <div class="badge">ğŸ”’ æœªåˆ°é‚£ä¸€å¤©</div>
        </div>
        <p>ä½ æƒ³æå‰å·çœ‹ï¼Ÿå¯çˆ±ï¼Œä½†ä¸è¡Œã€‚</p>
        <p style="margin-top:10px; color:rgba(255,255,255,.70); font-size:13px; line-height:1.7;">
          è§£é”è§„åˆ™ï¼šæ—¥æœŸ â‰¤ ä½ è®¾å¤‡çš„â€œä»Šå¤©â€ã€‚å¦‚æœä½ åªæ˜¯æƒ³æµ‹è¯•ï¼ŒæŠŠè®¾ç½®é‡Œçš„â€œä»Šå¤©è¦†ç›–â€æ”¹ä¸€ä¸‹ã€‚
        </p>
      </div>
    `;
    btnClose.disabled = false;
    renderMonth();
  }

  function showLetter(key) {
    selected = key;
    const text = LETTERS[key] || "";
    elSelectedHint.textContent = key + ' Â· å·²è§£é”';
    elContent.innerHTML = `
      <div class="letter">
        <div class="meta">
          <div class="date">${key}</div>
          <div class="badge">ğŸ¾ Nyx ç»™å°çŒ«çš„</div>
        </div>
        <p>${escapeHtml(text)}</p>
      </div>
    `;
    btnClose.disabled = false;
    renderMonth();
  }

  function escapeHtml(s){
    return (s||"").replace(/[&<>"']/g, (c)=>({
      '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'
    }[c]));
  }

  function closeLetter(){
    selected = null;
    elSelectedHint.textContent = "å…ˆç‚¹ä¸€ä¸ªæ—¥æœŸã€‚";
    elContent.innerHTML = `
      <div class="empty">
        <div class="big">ğŸ±</div>
        <div>è¿˜æ²¡é€‰æ—¥æœŸ</div>
        <div class="small">ä½ ç‚¹ä¸€ä¸‹ï¼Œæˆ‘å°±æŠŠé‚£ä¸€å¤©é€’ç»™ä½ ã€‚</div>
      </div>
    `;
    btnClose.disabled = true;
    renderMonth();
  }

  function refreshStatus(){
    const today = getToday();
    const todayKey = ymd(today);
    const tz = Intl.DateTimeFormat().resolvedOptions().timeZone || "unknown";
    tzHint.textContent = tz + " Â· æœ¬åœ°æ—¥æœŸï¼š" + todayKey;
    const total = Object.keys(LETTERS).length;
    let unlockedCount = 0;
    for(const k in LETTERS){
      if(Object.prototype.hasOwnProperty.call(LETTERS,k)) {
        if(parseYMD(k) <= today) unlockedCount++;
      }
    }
    elStatus.textContent = `å·²å†™ ${total} å¤© Â· å·²è§£é” ${unlockedCount} å¤©`;
  }

  function gotoToday(){
    const t = getToday();
    viewMonth = clampMonth(t);
    renderMonth();
    const k = ymd(t);
    if(LETTERS[k] && isInRange(t)) {
      if(isUnlocked(t)) showLetter(k);
      else showLocked(k);
    }
  }

  // drawer controls
  function openDrawer(){ drawer.classList.add('show'); drawer.setAttribute('aria-hidden','false'); }
  function closeDrawer(){ drawer.classList.remove('show'); drawer.setAttribute('aria-hidden','true'); }

  btnSettings.addEventListener('click', openDrawer);
  drawerBackdrop.addEventListener('click', closeDrawer);
  btnCloseDrawer.addEventListener('click', closeDrawer);

  modeSel.addEventListener('change', ()=>{ applyModeDim(); });
  overrideDate.addEventListener('change', ()=>{
    viewMonth = clampMonth(getToday());
    refreshStatus();
    renderMonth();
  });

  btnPrev.addEventListener('click', ()=>{ viewMonth = clampMonth(new Date(viewMonth.getFullYear(), viewMonth.getMonth()-1, 1)); renderMonth(); });
  btnNext.addEventListener('click', ()=>{ viewMonth = clampMonth(new Date(viewMonth.getFullYear(), viewMonth.getMonth()+1, 1)); renderMonth(); });
  btnToday.addEventListener('click', gotoToday);
  btnClose.addEventListener('click', closeLetter);

  // initial
  renderMonth();
  refreshStatus();

  // If your current month has no entries, jump to start month.
  const ym = (d)=>d.getFullYear()+'-'+pad2(d.getMonth()+1);
  if(ym(viewMonth) !== ym(minDate) && Object.keys(LETTERS).every(k=>k.slice(0,7)!==ym(viewMonth))) {
    viewMonth = new Date(minDate.getFullYear(), minDate.getMonth(), 1);
    renderMonth();
  }
})();
</script>
</body>
</html>
